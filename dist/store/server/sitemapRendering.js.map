{"version":3,"sources":["../../../src/store/server/sitemapRendering.js"],"names":["SITEMAP_EXCLUDE_PATH","sitemapRendering","req","res","Promise","all","sitemap","list","enabled","settings","retrieve","then","sitemapResponse","settingsResponse","sitemapArray","json","hostname","domain","length","protocol","urls","filter","item","type","includes","path","map","createSitemap","toXML","err","xml","error","message","status","end","header","send"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,uBAAuB,CAC5B,GAD4B,EAE5B,WAF4B,EAG5B,mBAH4B,EAI5B,UAJ4B,EAK5B,OAL4B,EAM5B,QAN4B,EAO5B,SAP4B,EAQ5B,SAR4B,EAS5B,SAT4B,EAU5B,WAV4B,CAA7B;;AAaA,IAAMC,mBAAmB,SAAnBA,gBAAmB,CAACC,GAAD,EAAMC,GAAN,EAAc;AACtCC,SAAQC,GAAR,CAAY,CACX,cAAIC,OAAJ,CAAYC,IAAZ,CAAiB,EAAEC,SAAS,IAAX,EAAjB,CADW,EAEX,cAAIC,QAAJ,CAAaC,QAAb,EAFW,CAAZ,EAGGC,IAHH,CAGQ,gBAAyC;AAAA;AAAA,MAAvCC,eAAuC;AAAA,MAAtBC,gBAAsB;;AAChD,MAAMC,eAAeF,gBAAgBG,IAArC;AACA,MAAMN,WAAWI,iBAAiBE,IAAlC;AACA,MAAMC,WACLP,SAASQ,MAAT,IAAmBR,SAASQ,MAAT,CAAgBC,MAAhB,GAAyB,CAA5C,GACGT,SAASQ,MADZ,GAEMf,IAAIiB,QAFV,WAEwBjB,IAAIc,QAH7B;;AAKA,MAAMI,OAAON,aACXO,MADW,CAEX;AAAA,UACCC,KAAKC,IAAL,KAAc,UAAd,IACAD,KAAKC,IAAL,KAAc,QADd,IAEA,CAACvB,qBAAqBwB,QAArB,CAA8BF,KAAKG,IAAnC,CAHF;AAAA,GAFW,EAOXC,GAPW,CAOP;AAAA,UAAQJ,KAAKG,IAAb;AAAA,GAPO,CAAb;AAQA,MAAMnB,UAAU,kBAAGqB,aAAH,CAAiB,EAAEX,kBAAF,EAAYI,UAAZ,EAAjB,CAAhB;AACAd,UAAQsB,KAAR,CAAc,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC3B,OAAID,GAAJ,EAAS;AACR,sBAAQE,KAAR,CAAcF,IAAIG,OAAJ,GAAcH,IAAIG,OAAlB,GAA4BH,GAA1C;AACA1B,QAAI8B,MAAJ,CAAW,GAAX,EAAgBC,GAAhB;AACA,IAHD,MAGO;AACN/B,QAAIgC,MAAJ,CAAW,cAAX,EAA2B,iBAA3B;AACAhC,QAAIiC,IAAJ,CAASN,GAAT;AACA;AACD,GARD;AASA,EA7BD;AA8BA,CA/BD;;kBAiCe7B,gB","file":"sitemapRendering.js","sourcesContent":["import sm from 'sitemap';\nimport winston from 'winston';\nimport api from './api';\n\nconst SITEMAP_EXCLUDE_PATH = [\n\t'/',\n\t'/checkout',\n\t'/checkout-success',\n\t'/account',\n\t'/cart',\n\t'/login',\n\t'/signin',\n\t'/logout',\n\t'/signup',\n\t'/register'\n];\n\nconst sitemapRendering = (req, res) => {\n\tPromise.all([\n\t\tapi.sitemap.list({ enabled: true }),\n\t\tapi.settings.retrieve()\n\t]).then(([sitemapResponse, settingsResponse]) => {\n\t\tconst sitemapArray = sitemapResponse.json;\n\t\tconst settings = settingsResponse.json;\n\t\tconst hostname =\n\t\t\tsettings.domain && settings.domain.length > 0\n\t\t\t\t? settings.domain\n\t\t\t\t: `${req.protocol}://${req.hostname}`;\n\n\t\tconst urls = sitemapArray\n\t\t\t.filter(\n\t\t\t\titem =>\n\t\t\t\t\titem.type !== 'reserved' &&\n\t\t\t\t\titem.type !== 'search' &&\n\t\t\t\t\t!SITEMAP_EXCLUDE_PATH.includes(item.path)\n\t\t\t)\n\t\t\t.map(item => item.path);\n\t\tconst sitemap = sm.createSitemap({ hostname, urls });\n\t\tsitemap.toXML((err, xml) => {\n\t\t\tif (err) {\n\t\t\t\twinston.error(err.message ? err.message : err);\n\t\t\t\tres.status(500).end();\n\t\t\t} else {\n\t\t\t\tres.header('Content-Type', 'application/xml');\n\t\t\t\tres.send(xml);\n\t\t\t}\n\t\t});\n\t});\n};\n\nexport default sitemapRendering;\n"]}