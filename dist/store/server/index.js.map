{"version":3,"sources":["../../../src/store/server/index.js"],"names":["app","ADMIN_INDEX_PATH","resolve","STATIC_OPTIONS","maxAge","set","use","get","req","res","next","newUrl","params","entity","id","filename","url","static","sendFile","status","end","cookieSecretKey","server","listen","storeListenPort","serverAddress","address","info","port"],"mappings":";;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,MAAM,wBAAZ;;AAEA,IAAMC,mBAAmB,eAAKC,OAAL,CAAa,yBAAb,CAAzB;AACA,IAAMC,iBAAiB;AACtBC,SAAQ,WADc,CACF;AADE,CAAvB;;AAIAJ,IAAIK,GAAJ,CAAQ,aAAR,EAAuB,CAAvB;AACAL,IAAIM,GAAJ,CAAQ,uBAAR;AACAN,IAAIO,GAAJ,CAAQ,qCAAR,EAA+C,UAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAClE;AACA,KAAMC,sBAAoBH,IAAII,MAAJ,CAAWC,MAA/B,SAAyCL,IAAII,MAAJ,CAAWE,EAApD,SACLN,IAAII,MAAJ,CAAWG,QADZ;AAGAP,KAAIQ,GAAJ,GAAUL,MAAV;AACAD;AACA,CAPD;AAQAV,IAAIM,GAAJ,CAAQ,kBAAQW,MAAR,CAAe,gBAAf,EAAiCd,cAAjC,CAAR;AACAH,IAAIM,GAAJ,CAAQ,SAAR,EAAmB,kBAAQW,MAAR,CAAe,cAAf,EAA+Bd,cAA/B,CAAnB;AACAH,IAAIM,GAAJ,CAAQ,eAAR,EAAyB,kBAAQW,MAAR,CAAe,qBAAf,EAAsCd,cAAtC,CAAzB;AACAH,IAAIM,GAAJ,CAAQ,QAAR,EAAkB,kBAAQW,MAAR,CAAe,oBAAf,CAAlB;AACAjB,IAAIM,GAAJ,CAAQ,QAAR,EAAkB,UAACE,GAAD,EAAMC,GAAN,EAAc;AAC/BA,KAAIS,QAAJ,CAAajB,gBAAb;AACA,CAFD;AAGAD,IAAIO,GAAJ,CACC,sEADD,EAEC,UAACC,GAAD,EAAMC,GAAN,EAAc;AACbA,KAAIU,MAAJ,CAAW,GAAX,EAAgBC,GAAhB;AACA,CAJF;AAMApB,IAAIO,GAAJ,CAAQ,aAAR;AACAP,IAAIO,GAAJ,CAAQ,cAAR;AACAP,IAAIO,GAAJ,CAAQ,GAAR;AACAP,IAAIM,GAAJ,CAAQ,6BAAR;AACAN,IAAIM,GAAJ,CAAQ,4BAAa,iBAASe,eAAtB,CAAR;AACArB,IAAIO,GAAJ,CAAQ,GAAR;;AAEA,IAAMe,SAAStB,IAAIuB,MAAJ,CAAW,iBAASC,eAApB,EAAqC,YAAM;AACzD,KAAMC,gBAAgBH,OAAOI,OAAP,EAAtB;AACA,mBAAQC,IAAR,wCAAkDF,cAAcG,IAAhE;AACA,CAHc,CAAf","file":"index.js","sourcesContent":["import express from 'express';\nimport helmet from 'helmet';\nimport responseTime from 'response-time';\nimport path from 'path';\nimport cookieParser from 'cookie-parser';\nimport winston from 'winston';\nimport settings from '../../../config/server';\nimport logger from './logger';\nimport robotsRendering from './robotsRendering';\nimport sitemapRendering from './sitemapRendering';\nimport redirects from './redirects';\nimport pageRendering from './pageRendering';\n\nconst app = express();\n\nconst ADMIN_INDEX_PATH = path.resolve('public/admin/index.html');\nconst STATIC_OPTIONS = {\n\tmaxAge: 31536000000 // One year\n};\n\napp.set('trust proxy', 1);\napp.use(helmet());\napp.get('/images/:entity/:id/:size/:filename', (req, res, next) => {\n\t// A stub of image resizing (can be done with Nginx)\n\tconst newUrl = `/images/${req.params.entity}/${req.params.id}/${\n\t\treq.params.filename\n\t}`;\n\treq.url = newUrl;\n\tnext();\n});\napp.use(express.static('public/content', STATIC_OPTIONS));\napp.use('/assets', express.static('theme/assets', STATIC_OPTIONS));\napp.use('/admin-assets', express.static('public/admin-assets', STATIC_OPTIONS));\napp.use('/sw.js', express.static('theme/assets/sw.js'));\napp.use('/admin', (req, res) => {\n\tres.sendFile(ADMIN_INDEX_PATH);\n});\napp.get(\n\t/^.+\\.(jpg|jpeg|gif|png|bmp|ico|webp|svg|css|js|zip|rar|flv|swf|xls)$/,\n\t(req, res) => {\n\t\tres.status(404).end();\n\t}\n);\napp.get('/robots.txt', robotsRendering);\napp.get('/sitemap.xml', sitemapRendering);\napp.get('*', redirects);\napp.use(responseTime());\napp.use(cookieParser(settings.cookieSecretKey));\napp.get('*', pageRendering);\n\nconst server = app.listen(settings.storeListenPort, () => {\n\tconst serverAddress = server.address();\n\twinston.info(`Store running at http://localhost:${serverAddress.port}`);\n});\n"]}