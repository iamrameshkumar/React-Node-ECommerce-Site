{"version":3,"sources":["../../../src/components/products/viewed.js"],"names":["ViewedProducts","state","viewedProducts","getArrayFromLocalStorage","values","localStorage","getItem","length","viewedProductsParsed","JSON","parse","Array","isArray","e","addProductIdToLocalStorage","productId","includes","index","indexOf","splice","push","setItem","stringify","setState","componentDidMount","product","props","id","componentWillReceiveProps","nextProps","shouldComponentUpdate","nextState","render","limit","settings","addCartItem","filter","ids","reverse","slice","recentlyViewed","Component","propTypes","number","isRequired","shape","func"],"mappings":"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","file":"viewed.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { text } from '../../lib/settings';\nimport CustomProductList from './custom';\n\nexport default class ViewedProducts extends React.Component {\n\tstatic propTypes = {\n\t\tlimit: PropTypes.number.isRequired,\n\t\tsettings: PropTypes.shape({}).isRequired,\n\t\taddCartItem: PropTypes.func.isRequired,\n\t\tproduct: PropTypes.shape({}).isRequired\n\t};\n\n\tstate = {\n\t\tviewedProducts: []\n\t};\n\n\tcomponentDidMount() {\n\t\tconst { product } = this.props;\n\t\tconst viewedProducts = this.getArrayFromLocalStorage();\n\t\tthis.setState({ viewedProducts });\n\n\t\tif (product && product.id) {\n\t\t\tthis.addProductIdToLocalStorage(product.id);\n\t\t}\n\t}\n\n\tcomponentWillReceiveProps(nextProps) {\n\t\tif (\n\t\t\tthis.props.product !== nextProps.product &&\n\t\t\tnextProps.product &&\n\t\t\tnextProps.product.id\n\t\t) {\n\t\t\tthis.addProductIdToLocalStorage(nextProps.product.id);\n\t\t}\n\t}\n\n\tshouldComponentUpdate(nextProps, nextState) {\n\t\treturn this.state.viewedProducts !== nextState.viewedProducts;\n\t}\n\n\tgetArrayFromLocalStorage = () => {\n\t\tlet values = [];\n\t\tconst viewedProducts = localStorage.getItem('viewedProducts');\n\n\t\ttry {\n\t\t\tif (viewedProducts && viewedProducts.length > 0) {\n\t\t\t\tconst viewedProductsParsed = JSON.parse(viewedProducts);\n\t\t\t\tif (Array.isArray(viewedProductsParsed)) {\n\t\t\t\t\tvalues = viewedProductsParsed;\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t//\n\t\t}\n\n\t\treturn values;\n\t};\n\n\taddProductIdToLocalStorage = productId => {\n\t\tif (productId && productId.length > 0) {\n\t\t\tconst viewedProducts = this.getArrayFromLocalStorage();\n\n\t\t\tif (viewedProducts.includes(productId)) {\n\t\t\t\tconst index = viewedProducts.indexOf(productId);\n\t\t\t\tviewedProducts.splice(index, 1);\n\t\t\t\tviewedProducts.push(productId);\n\t\t\t} else {\n\t\t\t\tviewedProducts.push(productId);\n\t\t\t}\n\n\t\t\tlocalStorage.setItem('viewedProducts', JSON.stringify(viewedProducts));\n\t\t\tthis.setState({ viewedProducts });\n\t\t}\n\t};\n\n\trender() {\n\t\tconst { limit, settings, addCartItem, product } = this.props;\n\t\tlet { viewedProducts } = this.state;\n\n\t\tif (viewedProducts && product && product.id) {\n\t\t\tviewedProducts = viewedProducts.filter(id => id !== product.id);\n\t\t}\n\n\t\tif (viewedProducts && viewedProducts.length > 0) {\n\t\t\tconst ids = viewedProducts.reverse().slice(0, limit);\n\t\t\treturn (\n\t\t\t\t<section className=\"section section-product-related\">\n\t\t\t\t\t<div className=\"container\">\n\t\t\t\t\t\t<div className=\"title is-4 has-text-centered\">\n\t\t\t\t\t\t\t{text.recentlyViewed}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<CustomProductList\n\t\t\t\t\t\t\tids={ids}\n\t\t\t\t\t\t\tsettings={settings}\n\t\t\t\t\t\t\taddCartItem={addCartItem}\n\t\t\t\t\t\t\tlimit={limit}\n\t\t\t\t\t\t\tisCentered\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</section>\n\t\t\t);\n\t\t}\n\t\treturn null;\n\t}\n}\n"]}